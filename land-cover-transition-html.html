<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Land Cover Transition Probability Matrix</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: system-ui, -apple-system, sans-serif;
            background: #f5f5f5;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React icons as inline SVG components
        const Play = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="5 3 19 12 5 21 5 3"></polygon>
            </svg>
        );

        const Pause = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="6" y="4" width="4" height="16"></rect>
                <rect x="14" y="4" width="4" height="16"></rect>
            </svg>
        );

        const RotateCcw = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="1 4 1 10 7 10"></polyline>
                <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
            </svg>
        );

        const ChevronRight = ({ className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const ChevronLeft = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
        );

        const LandCoverTransitionMatrix = () => {
            const [step, setStep] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);

            const landCoverTypes = ['Forest', 'Agriculture', 'Urban', 'Water'];
            const colors = {
                'Forest': '#2d5016',
                'Agriculture': '#f4d03f',
                'Urban': '#95a5a6',
                'Water': '#3498db'
            };

            const initialData = [
                ['Forest', 'Forest', 'Agriculture', 'Forest'],
                ['Forest', 'Agriculture', 'Forest', 'Urban'],
                ['Water', 'Forest', 'Agriculture', 'Agriculture'],
                ['Agriculture', 'Urban', 'Water', 'Forest']
            ];

            const finalData = [
                ['Forest', 'Agriculture', 'Agriculture', 'Forest'],
                ['Agriculture', 'Agriculture', 'Urban', 'Urban'],
                ['Water', 'Forest', 'Urban', 'Urban'],
                ['Agriculture', 'Urban', 'Water', 'Agriculture']
            ];

            const totalCounts = {
                'Forest': 7,
                'Agriculture': 5,
                'Urban': 2,
                'Water': 2
            };

            const steps = [
                {
                    title: "Initial State (Time T1)",
                    description: "This is our land cover at the initial time period. We have 4 types: Forest, Agriculture, Urban, and Water.",
                    showInitial: true,
                    showFinal: false,
                    showMatrix: false
                },
                {
                    title: "Final State (Time T2)",
                    description: "This is the land cover after some time has passed. Some cells have changed land cover types.",
                    showInitial: false,
                    showFinal: true,
                    showMatrix: false
                },
                {
                    title: "Counting Transitions",
                    description: "We count how many cells of each type transitioned to each other type. For example, 'Forest→Agriculture' means a Forest cell became Agriculture.",
                    showInitial: true,
                    showFinal: true,
                    showMatrix: false
                },
                {
                    title: "Building the Count Matrix",
                    description: "We organize all transition counts into a matrix. Rows = initial state, Columns = final state.",
                    showMatrix: true,
                    matrixType: 'counts'
                },
                {
                    title: "Calculating Probabilities",
                    description: "To get probabilities, we divide each row by the total count for that initial land cover type. For Forest: 7 total cells.",
                    showMatrix: true,
                    matrixType: 'calculation',
                    highlightRow: 0
                },
                {
                    title: "Transition Probability Matrix",
                    description: "The final matrix shows the probability of each transition. Each row sums to 1.0 (100%).",
                    showMatrix: true,
                    matrixType: 'probabilities'
                }
            ];

            useEffect(() => {
                let interval;
                if (isPlaying && step < steps.length - 1) {
                    interval = setInterval(() => {
                        setStep(s => s + 1);
                    }, 3000);
                } else if (step >= steps.length - 1) {
                    setIsPlaying(false);
                }
                return () => clearInterval(interval);
            }, [isPlaying, step]);

            const currentStep = steps[step];

            const renderGrid = (data, label) => (
                <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                    <h3 style={{ fontSize: '0.875rem', fontWeight: '600', marginBottom: '0.5rem' }}>{label}</h3>
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '0.25rem' }}>
                        {data.flat().map((cell, idx) => (
                            <div
                                key={idx}
                                style={{
                                    width: '3rem',
                                    height: '3rem',
                                    display: 'flex',
                                    alignItems: 'center',
                                    justifyContent: 'center',
                                    fontSize: '0.75rem',
                                    fontWeight: '500',
                                    color: 'white',
                                    borderRadius: '0.25rem',
                                    backgroundColor: colors[cell]
                                }}
                                title={cell}
                            >
                                {cell[0]}
                            </div>
                        ))}
                    </div>
                </div>
            );

            const renderCountMatrix = () => {
                const matrix = [
                    [4, 3, 0, 0],
                    [0, 3, 2, 0],
                    [0, 0, 2, 0],
                    [0, 0, 0, 2]
                ];
                
                return (
                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                        <h3 style={{ fontSize: '1.125rem', fontWeight: '600', marginBottom: '1rem' }}>Transition Count Matrix</h3>
                        <table style={{ borderCollapse: 'collapse' }}>
                            <thead>
                                <tr>
                                    <th style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#f3f4f6' }}></th>
                                    {landCoverTypes.map(type => (
                                        <th key={type} style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontSize: '0.75rem' }}>
                                            {type}
                                        </th>
                                    ))}
                                    <th style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#dbeafe', fontSize: '0.75rem', fontWeight: 'bold' }}>Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                {landCoverTypes.map((fromType, i) => (
                                    <tr key={fromType} style={{ background: currentStep.highlightRow === i ? '#fef3c7' : 'white' }}>
                                        <td style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontWeight: '600', fontSize: '0.75rem' }}>
                                            {fromType}
                                        </td>
                                        {matrix[i].map((count, j) => (
                                            <td key={j} style={{ border: '1px solid #9ca3af', padding: '0.75rem', textAlign: 'center', fontFamily: 'monospace' }}>
                                                {count}
                                            </td>
                                        ))}
                                        <td style={{ border: '1px solid #9ca3af', padding: '0.75rem', textAlign: 'center', fontWeight: 'bold', background: '#dbeafe' }}>
                                            {totalCounts[fromType]}
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            };

            const renderCalculationMatrix = () => {
                const matrix = [
                    [4, 3, 0, 0],
                    [0, 3, 2, 0],
                    [0, 0, 2, 0],
                    [0, 0, 0, 2]
                ];
                
                return (
                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                        <h3 style={{ fontSize: '1.125rem', fontWeight: '600', marginBottom: '1rem' }}>Calculating Probabilities</h3>
                        <div style={{ marginBottom: '1rem', fontSize: '0.875rem', background: '#eff6ff', padding: '0.75rem', borderRadius: '0.25rem' }}>
                            <p style={{ fontWeight: '600', margin: '0 0 0.5rem 0' }}>Example: Forest row</p>
                            <p style={{ margin: '0 0 0.25rem 0' }}>Total Forest cells at T1: <span style={{ fontWeight: 'bold' }}>7</span></p>
                            <p style={{ margin: '0.5rem 0 0.25rem 0' }}>Forest→Forest: 4/7 = 0.571</p>
                            <p style={{ margin: '0 0 0.25rem 0' }}>Forest→Agriculture: 3/7 = 0.429</p>
                            <p style={{ margin: '0 0 0.25rem 0' }}>Forest→Urban: 0/7 = 0.000</p>
                            <p style={{ margin: '0' }}>Forest→Water: 0/7 = 0.000</p>
                        </div>
                        <table style={{ borderCollapse: 'collapse' }}>
                            <thead>
                                <tr>
                                    <th style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#f3f4f6' }}></th>
                                    {landCoverTypes.map(type => (
                                        <th key={type} style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontSize: '0.75rem' }}>
                                            {type}
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {landCoverTypes.map((fromType, i) => (
                                    <tr key={fromType} style={{ background: i === 0 ? '#fef3c7' : 'white' }}>
                                        <td style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontWeight: '600', fontSize: '0.75rem' }}>
                                            {fromType}
                                        </td>
                                        {matrix[i].map((count, j) => (
                                            <td key={j} style={{ border: '1px solid #9ca3af', padding: '0.75rem', textAlign: 'center', fontSize: '0.75rem' }}>
                                                {count}/{totalCounts[fromType]}
                                            </td>
                                        ))}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                );
            };

            const renderProbabilityMatrix = () => {
                const matrix = [
                    [0.571, 0.429, 0.000, 0.000],
                    [0.000, 0.600, 0.400, 0.000],
                    [0.000, 0.000, 1.000, 0.000],
                    [0.000, 0.000, 0.000, 1.000]
                ];
                
                return (
                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                        <h3 style={{ fontSize: '1.125rem', fontWeight: '600', marginBottom: '1rem' }}>Transition Probability Matrix</h3>
                        <table style={{ borderCollapse: 'collapse' }}>
                            <thead>
                                <tr>
                                    <th style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#f3f4f6', fontSize: '0.75rem' }}>From \ To</th>
                                    {landCoverTypes.map(type => (
                                        <th key={type} style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontSize: '0.75rem' }}>
                                            {type}
                                        </th>
                                    ))}
                                    <th style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#d1fae5', fontSize: '0.75rem', fontWeight: 'bold' }}>Row Sum</th>
                                </tr>
                            </thead>
                            <tbody>
                                {landCoverTypes.map((fromType, i) => (
                                    <tr key={fromType}>
                                        <td style={{ border: '1px solid #9ca3af', padding: '0.5rem', background: '#e5e7eb', fontWeight: '600', fontSize: '0.75rem' }}>
                                            {fromType}
                                        </td>
                                        {matrix[i].map((prob, j) => (
                                            <td
                                                key={j}
                                                style={{
                                                    border: '1px solid #9ca3af',
                                                    padding: '0.75rem',
                                                    textAlign: 'center',
                                                    fontFamily: 'monospace',
                                                    backgroundColor: prob > 0 ? `rgba(52, 152, 219, ${prob * 0.5})` : 'white'
                                                }}
                                            >
                                                {prob.toFixed(3)}
                                            </td>
                                        ))}
                                        <td style={{ border: '1px solid #9ca3af', padding: '0.75rem', textAlign: 'center', fontWeight: 'bold', background: '#d1fae5' }}>
                                            1.000
                                        </td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                        <p style={{ marginTop: '1rem', fontSize: '0.875rem', color: '#4b5563' }}>Each row represents the probability distribution of where that land cover type will transition to.</p>
                    </div>
                );
            };

            return (
                <div style={{ maxWidth: '80rem', margin: '0 auto', padding: '1.5rem', background: 'white', borderRadius: '0.5rem' }}>
                    <h1 style={{ fontSize: '1.875rem', fontWeight: 'bold', textAlign: 'center', marginBottom: '0.5rem' }}>Land Cover Transition Probability Matrix</h1>
                    <p style={{ textAlign: 'center', color: '#4b5563', marginBottom: '1.5rem' }}>Understanding how land changes over time</p>

                    <div style={{ marginBottom: '1.5rem' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '0.5rem' }}>
                            <span style={{ fontSize: '0.875rem', fontWeight: '600' }}>Step {step + 1} of {steps.length}</span>
                            <span style={{ fontSize: '0.875rem', color: '#4b5563' }}>{currentStep.title}</span>
                        </div>
                        <div style={{ width: '100%', background: '#e5e7eb', borderRadius: '9999px', height: '0.5rem' }}>
                            <div
                                style={{
                                    background: '#3b82f6',
                                    height: '0.5rem',
                                    borderRadius: '9999px',
                                    transition: 'width 0.3s',
                                    width: `${((step + 1) / steps.length) * 100}%`
                                }}
                            />
                        </div>
                    </div>

                    <div style={{ background: '#eff6ff', borderLeft: '4px solid #3b82f6', padding: '1rem', marginBottom: '1.5rem' }}>
                        <p style={{ fontSize: '0.875rem', margin: 0 }}>{currentStep.description}</p>
                    </div>

                    <div style={{ minHeight: '24rem', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '1.5rem' }}>
                        {currentStep.showInitial && currentStep.showFinal && (
                            <div style={{ display: 'flex', gap: '2rem', alignItems: 'flex-start' }}>
                                {renderGrid(initialData, "Time T1 (Initial)")}
                                <div style={{ display: 'flex', alignItems: 'center' }}>
                                    <ChevronRight className="w-8 h-8 text-gray-400" />
                                </div>
                                {renderGrid(finalData, "Time T2 (Final)")}
                            </div>
                        )}
                        {currentStep.showInitial && !currentStep.showFinal && renderGrid(initialData, "Time T1 (Initial)")}
                        {!currentStep.showInitial && currentStep.showFinal && renderGrid(finalData, "Time T2 (Final)")}
                        {currentStep.showMatrix && currentStep.matrixType === 'counts' && renderCountMatrix()}
                        {currentStep.showMatrix && currentStep.matrixType === 'calculation' && renderCalculationMatrix()}
                        {currentStep.showMatrix && currentStep.matrixType === 'probabilities' && renderProbabilityMatrix()}
                    </div>

                    <div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '1rem' }}>
                        <button
                            onClick={() => {
                                setStep(0);
                                setIsPlaying(false);
                            }}
                            style={{ padding: '0.5rem', borderRadius: '0.5rem', background: '#e5e7eb', border: 'none', cursor: 'pointer' }}
                            title="Reset"
                        >
                            <RotateCcw />
                        </button>
                        <button
                            onClick={() => setStep(Math.max(0, step - 1))}
                            disabled={step === 0}
                            style={{ padding: '0.5rem', borderRadius: '0.5rem', background: '#e5e7eb', border: 'none', cursor: 'pointer', opacity: step === 0 ? 0.5 : 1 }}
                        >
                            <ChevronLeft />
                        </button>
                        <button
                            onClick={() => setIsPlaying(!isPlaying)}
                            style={{ padding: '0.5rem 1.5rem', borderRadius: '0.5rem', background: '#3b82f6', color: 'white', fontWeight: '600', border: 'none', cursor: 'pointer' }}
                        >
                            {isPlaying ? <Pause /> : <Play />}
                        </button>
                        <button
                            onClick={() => setStep(Math.min(steps.length - 1, step + 1))}
                            disabled={step === steps.length - 1}
                            style={{ padding: '0.5rem', borderRadius: '0.5rem', background: '#e5e7eb', border: 'none', cursor: 'pointer', opacity: step === steps.length - 1 ? 0.5 : 1 }}
                        >
                            <ChevronRight />
                        </button>
                    </div>

                    <div style={{ marginTop: '2rem', padding: '1rem', background: '#f9fafb', borderRadius: '0.5rem' }}>
                        <h4 style={{ fontWeight: '600', marginBottom: '0.5rem', fontSize: '0.875rem' }}>Land Cover Types:</h4>
                        <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem' }}>
                            {landCoverTypes.map(type => (
                                <div key={type} style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                                    <div style={{ width: '1.5rem', height: '1.5rem', borderRadius: '0.25rem', backgroundColor: colors[type] }} />
                                    <span style={{ fontSize: '0.875rem' }}>{type}</span>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<LandCoverTransitionMatrix />, document.getElementById('root'));
    </script>
</body>
</html>